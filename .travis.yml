sudo: required
services:
  - docker
cache:
  bundler: false
  directories:
  - .cache          # images.txt
# Handle git submodules yourself
git:
    submodules: false

# Do a github login using token
before_install:
  - "echo -e \"machine github.com\n  login ci-user\n  password ${GITHUB_USER_TOKEN}\" >> ${HOME}/.netrc"
script: 
  - tar cvfz flogo-contrib.tgz .
  - find . -not -name "flogo-contrib.tgz" -not  -name "\." -not -name "\.\."  -print0 | xargs -0 rm -rf --
  - git clone https://github.com/TIBCOSoftware/flogo-cicd.git flogo-cicd
  - pushd flogo-cicd/docker/flogo-contrib
  - ./build-flogo-contrib.sh
  - popd
after_script:
  - "[ -f \"${HOME}/.netrc\" ] && rm -f ${HOME}/.netrc"

after_success:
  - "if [ \"${TRAVIS_BRANCH}\" == \"master\" ]; then
    docker login -u=\"${DOCKER_USERNAME}\" -p=\"${DOCKER_PASSWORD}\";
    source ./submodules/flogo-cicd/scripts/init.sh ;
    # docker::copy_tag_and_push flogo/flogo-contrib pdhar/flogo-contrib;
    fi"
